# üöÄ PLAN DE MEJORA: VISOR 3D + MAPA INTERACTIVO - PROYECTO MUNAY-SNCALE

**Proyecto:** Sistema Nacional de Centros de Ense√±anza Automovil√≠stica (SNCALE)
**Versi√≥n:** 3.0 - Integraci√≥n Total con Google Sheets (Visor 3D + Mapa Interactivo)
**Fecha Inicio:** 2025-10-29
**Estado:** üü° EN PLANIFICACI√ìN
**Prioridad:** üî¥ ALTA - Sistema en producci√≥n con error visible

**Hojas de Google Sheets (Fuente √önica de Verdad):**
- üìä [Hoja 1: Presupuesto BIM (125 productos)](https://docs.google.com/spreadsheets/d/1ibTlTyAELNoMg6eERPvddPBdsu-eRvWuXlIbI5kDFqU/edit?gid=1032260683)
- üó∫Ô∏è [Hoja 2: Ubicaciones CALE (141 centros)](https://docs.google.com/spreadsheets/d/1ibTlTyAELNoMg6eERPvddPBdsu-eRvWuXlIbI5kDFqU/edit?gid=197105959)

---

## üìã TABLA DE CONTENIDOS

1. [Resumen Ejecutivo](#resumen-ejecutivo)
2. [Diagn√≥stico Actual](#diagn√≥stico-actual)
3. [Objetivos del Proyecto](#objetivos-del-proyecto)
4. [Arquitectura Nueva](#arquitectura-nueva)
5. [Plan de Trabajo](#plan-de-trabajo)
6. [Checklist de Progreso](#checklist-de-progreso)
7. [Comandos y Referencias](#comandos-y-referencias)

---

## üìä RESUMEN EJECUTIVO

### **Problema Actual**

#### **üîß Visor BIM 3D**
- ‚ùå CDN de xeokit con URL incorrecta (404)
- ‚ùå Arquitectura incompatible (espera script global, pero xeokit solo soporta ES6 modules)
- ‚ùå Nomenclatura de categor√≠as desactualizada (CAT.X en vez de CALE.n_X)
- ‚ùå Datos hardcodeados en HTML (no sincronizados con Google Sheets)

#### **üó∫Ô∏è Mapa Interactivo**
- ‚ùå Nomenclatura desactualizada en CSV (Cat.A+, Cat.B, Cat.C1 en vez de CALE.n_X)
- ‚ùå Datos hardcodeados en HTML (no sincronizados con Google Sheets)
- ‚ùå Sin actualizaci√≥n autom√°tica desde fuente √∫nica
- ‚ùå Coordenadas y ubicaciones en archivos separados (falta de coherencia)

### **Soluci√≥n Propuesta**

#### **Sistema Unificado de Sincronizaci√≥n**
- ‚úÖ **DOS hojas de Google Sheets** como fuente √∫nica de verdad
- ‚úÖ **UN script de sincronizaci√≥n** que actualiza ambos sistemas
- ‚úÖ Xeokit SDK con ES6 modules (visor 3D)
- ‚úÖ Leaflet.js actualizado (mapa interactivo)
- ‚úÖ Actualizaci√≥n autom√°tica de nomenclatura CALE.n_X en ambos sistemas
- ‚úÖ Coherencia total entre visor 3D, mapa y fichas t√©cnicas

### **Impacto Esperado**
- üéØ Visor 3D funcional en GitHub Pages
- üéØ Mapa interactivo con datos actualizados
- üéØ **Cambios en Google Sheets actualizan TODO el sistema:**
  - Visor 3D (componentes BIM)
  - Mapa interactivo (ubicaciones + categor√≠as)
  - Fichas t√©cnicas (costos + specs)
  - Presupuestos (CAPEX/OPEX)
- üéØ Nomenclatura unificada MUNAY 5.3 (CALE.n_X)
- üéØ Base de c√≥digo moderna y escalable
- üéØ **Un solo punto de actualizaci√≥n** para todos los sistemas

---

## üîç DIAGN√ìSTICO ACTUAL

### **Estado del Visor 3D**

**URL Afectada:**
https://ccolombia-ui.github.io/sncale-plan-implementacion/fichas_bim/visor_bim_3d.html

**Error Visible:**
```
‚ùå Error: No se pudo cargar xeokit
Verifica conexi√≥n a internet o usa versi√≥n local
```

### **An√°lisis T√©cnico**

| Componente | Estado | Problema Identificado |
|-----------|---------|----------------------|
| **CDN Xeokit** | ‚ùå ROTO | URL `https://cdn.jsdelivr.net/npm/@xeokit/xeokit-sdk@latest/dist/xeokit-sdk.min.js` devuelve **404** |
| **Arquitectura JS** | ‚ùå INCOMPATIBLE | C√≥digo espera `xeokit` global, pero SDK solo distribuye **ES6 modules** |
| **Datos BIM** | ‚ö†Ô∏è DESACTUALIZADOS | Datos hardcodeados en HTML (√∫ltima actualizaci√≥n: hace semanas) |
| **Nomenclatura** | ‚ö†Ô∏è OBSOLETA | Usa `CAT.A+`, `CAT.B` en vez de `CALE.n_1+`, `CALE.n_2` |
| **Integraci√≥n Sheets** | ‚ùå NO EXISTE | No hay sincronizaci√≥n con Google Sheets (fuente √∫nica de verdad) |

### **Causa Ra√≠z**

**Problema 1: CDN Incorrecto**
```html
<!-- ‚ùå ESTO NO EXISTE -->
<script src="https://cdn.jsdelivr.net/npm/@xeokit/xeokit-sdk@latest/dist/xeokit-sdk.min.js"></script>

<!-- ‚úÖ VERSI√ìN CORRECTA (ES6 Module) -->
<script type="module">
  import {Viewer} from "https://cdn.jsdelivr.net/npm/@xeokit/xeokit-sdk/dist/xeokit-sdk.es.min.js";
</script>
```

**Problema 2: Arquitectura Incompatible**
```javascript
// ‚ùå C√ìDIGO ACTUAL (espera global)
const viewer = new xeokit.Viewer({...});

// ‚úÖ C√ìDIGO CORRECTO (ES6 import)
import {Viewer} from "...";
const viewer = new Viewer({...});
```

---

### **Estado del Mapa Interactivo**

**URL Actual:**
https://ccolombia-ui.github.io/sncale-plan-implementacion/mapa_cale.html (o similar)

**Problemas Identificados:**

| Componente | Estado | Problema Identificado |
|-----------|---------|----------------------|
| **Datos de Ubicaciones** | ‚ö†Ô∏è DESACTUALIZADOS | CSV con nomenclatura antigua (Cat.A+, Cat.B, Cat.C1) |
| **Sincronizaci√≥n** | ‚ùå NO EXISTE | Datos hardcodeados, no sincronizados con Google Sheets |
| **Nomenclatura** | ‚ùå OBSOLETA | 141 centros usando Cat.X en vez de CALE.n_X |
| **Coordenadas** | ‚ö†Ô∏è DISPERSAS | Datos en m√∫ltiples archivos (CSV, JSON) sin coherencia |
| **Integraci√≥n BIM** | ‚ùå D√âBIL | Mapa no conecta con visor 3D ni fichas t√©cnicas |

**Datos Actuales del CSV:**
```csv
centro_id,tipo_centro,municipio,departamento,latitud,longitud,categoria_cale,demanda_estimada_anual
NODO_01,NODO_PRINCIPAL,"BOGOT√Å, D.C.","BOGOT√Å, D.C.",4.649251,-74.106992,Cat.A+,80453
NODO_22,NODO_PRINCIPAL,SANTA F√â DE ANTIOQUIA,ANTIOQUIA,6.556484,-75.826648,Cat.B**,32510
NODO_41,NODO_PRINCIPAL,San Andr√©s,SANTANDER,6.811511,-72.848864,Cat.C1,16000
```

**Necesita migraci√≥n a:**
```csv
categoria_cale,nueva_nomenclatura
Cat.A+,CALE.n_1+
Cat.A,CALE.n_1
Cat.B**,CALE.n_2**
Cat.B,CALE.n_2
Cat.C1,CALE.n_3
Cat.C2,CALE.C2
Cat.C3,CALE.C3
```

**Arquitectura Actual del Mapa:**
- **Librer√≠a:** Leaflet.js 1.9.4 ‚úÖ (moderna, no requiere cambio)
- **Datos:** CSV est√°tico ‚Üí Necesita actualizaci√≥n desde Google Sheets
- **Markers:** Colores por categor√≠a ‚Üí Actualizar colores para CALE.n_X
- **Popups:** Informaci√≥n de centros ‚Üí Conectar con visor 3D y fichas

---

## üéØ OBJETIVOS DEL PROYECTO

### **Objetivos Principales**

1. **[OBJ-1] Visor 3D Funcional**
   - ‚úÖ Carga correcta de xeokit SDK
   - ‚úÖ Renderizado de modelos BIM 3D
   - ‚úÖ Navegaci√≥n interactiva (rotar, zoom, pan)
   - ‚úÖ Sin errores en consola

2. **[OBJ-2] Mapa Interactivo Actualizado**
   - ‚úÖ Sincronizaci√≥n con Google Sheets (141 centros)
   - ‚úÖ Nomenclatura CALE.n_X actualizada
   - ‚úÖ Marcadores con colores actualizados
   - ‚úÖ Links a visor 3D y fichas t√©cnicas

3. **[OBJ-3] Integraci√≥n Google Sheets (FUENTE √öNICA)**
   - ‚úÖ **Hoja 1:** Presupuesto BIM (125 productos) ‚Üí Visor 3D + Fichas
   - ‚úÖ **Hoja 2:** Ubicaciones CALE (141 centros) ‚Üí Mapa Interactivo
   - ‚úÖ Script Python unificado para conversi√≥n Sheets ‚Üí JSON
   - ‚úÖ Un solo comando actualiza TODO el sistema

4. **[OBJ-4] Actualizaci√≥n Nomenclatura (AMBOS SISTEMAS)**
   - ‚úÖ Migrar `Cat.A+` ‚Üí `CALE.n_1+`
   - ‚úÖ Migrar `Cat.A` ‚Üí `CALE.n_1`
   - ‚úÖ Migrar `Cat.B**` ‚Üí `CALE.n_2**`
   - ‚úÖ Migrar `Cat.B` ‚Üí `CALE.n_2`
   - ‚úÖ Migrar `Cat.C1` ‚Üí `CALE.n_3`
   - ‚úÖ Mantener `CALE.C2`, `CALE.C3` sin cambios
   - ‚úÖ Aplicar en: Visor 3D, Mapa, CSVs, JSONs, HTMLs

5. **[OBJ-5] Arquitectura Moderna Unificada**
   - ‚úÖ C√≥digo ES6 modules (visor 3D)
   - ‚úÖ Leaflet.js optimizado (mapa)
   - ‚úÖ Separaci√≥n de datos y presentaci√≥n
   - ‚úÖ Documentaci√≥n completa
   - ‚úÖ Sistema interconectado (mapa ‚Üî visor ‚Üî fichas)

### **M√©tricas de √âxito**

| M√©trica | Estado Actual | Meta |
|---------|---------------|------|
| **Visor 3D funcional** | ‚ùå 0% | ‚úÖ 100% |
| **Mapa interactivo actualizado** | ‚ö†Ô∏è 50% (funciona pero desactualizado) | ‚úÖ 100% |
| **Datos sincronizados con Sheets** | ‚ùå 0% | ‚úÖ 100% (ambas hojas) |
| **Nomenclatura CALE actualizada** | ‚ùå 0% | ‚úÖ 100% (visor + mapa + CSVs) |
| **141 centros con ubicaciones correctas** | ‚ö†Ô∏è 70% (desactualizado) | ‚úÖ 100% |
| **125 productos BIM validados** | ‚ö†Ô∏è 80% (sin SE√ë-XXX) | ‚úÖ 100% |
| **Errores en consola** | ‚ùå 5+ errores | ‚úÖ 0 errores |
| **Tiempo de carga (visor)** | ‚ö†Ô∏è N/A (no carga) | ‚úÖ <3 segundos |
| **Tiempo de carga (mapa)** | ‚úÖ 2 segundos | ‚úÖ <2 segundos |
| **Coherencia entre sistemas** | ‚ùå 30% (datos dispersos) | ‚úÖ 100% (fuente √∫nica) |

---

## üèóÔ∏è ARQUITECTURA NUEVA

### **Diagrama de Flujo de Datos - Sistema Unificado**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   GOOGLE SHEETS (Fuente √önica de Verdad)                    ‚îÇ
‚îÇ         https://docs.google.com/spreadsheets/d/1ibTlTyA.../edit             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                             ‚îÇ
‚îÇ  üìä HOJA 1: "Presupuesto BIM"         üó∫Ô∏è HOJA 2: "Ubicaciones CALE"        ‚îÇ
‚îÇ  (gid=1032260683)                     (gid=197105959)                      ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îÇ  ‚Ä¢ 125 productos BIM                  ‚Ä¢ 141 centros CALE                   ‚îÇ
‚îÇ  ‚Ä¢ C√≥digos ERP (MAT-XXX, SE√ë-XXX)     ‚Ä¢ Coordenadas (lat/lng)              ‚îÇ
‚îÇ  ‚Ä¢ Categor√≠as CALE.n_X                ‚Ä¢ Categor√≠as CALE.n_X                ‚îÇ
‚îÇ  ‚Ä¢ CAPEX, OPEX, TCO                   ‚Ä¢ Demanda estimada                   ‚îÇ
‚îÇ  ‚Ä¢ Clases IFC                         ‚Ä¢ Municipios/Departamentos           ‚îÇ
‚îÇ  ‚Ä¢ Proveedores, Garant√≠as             ‚Ä¢ Nodos principales/sat√©lites        ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ                                          ‚îÇ
           ‚îÇ [1a] Exportar CSV                        ‚îÇ [1b] Exportar CSV
           ‚ñº                                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ SNCALE_Presupuesto_125.csv       ‚îÇ    ‚îÇ MUNAY_5.3_Ubicaciones_141.csv     ‚îÇ
‚îÇ (services/google_sheets/)        ‚îÇ    ‚îÇ (services/google_sheets/)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ                                          ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ [2] Script Python UNIFICADO
                            ‚ñº
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ   services/google_sheets/sync_sistema_completo.py      ‚îÇ
           ‚îÇ                                                        ‚îÇ
           ‚îÇ   class SyncSistemaCompleto:                           ‚îÇ
           ‚îÇ     def sync_presupuesto_bim()   # Hoja 1 ‚Üí Visor 3D  ‚îÇ
           ‚îÇ     def sync_ubicaciones_mapa()  # Hoja 2 ‚Üí Mapa      ‚îÇ
           ‚îÇ     def actualizar_nomenclatura() # CAT ‚Üí CALE        ‚îÇ
           ‚îÇ     def generar_fichas_html()    # Fichas t√©cnicas    ‚îÇ
           ‚îÇ     def validar_coherencia()     # 125 + 141 OK       ‚îÇ
           ‚îÇ                                                        ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ [3a] JSON BIM                 ‚îÇ [3b] JSON Mapa
                    ‚ñº                               ‚ñº
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ catalogo_bim_completo.json      ‚îÇ    ‚îÇ ubicaciones_cale_141.json        ‚îÇ
  ‚îÇ (fichas_bim/datos_json/)        ‚îÇ    ‚îÇ (mapa_cale/datos/)               ‚îÇ
  ‚îÇ                                 ‚îÇ    ‚îÇ                                  ‚îÇ
  ‚îÇ {                               ‚îÇ    ‚îÇ {                                ‚îÇ
  ‚îÇ   "version": "5.3",             ‚îÇ    ‚îÇ   "version": "5.3",              ‚îÇ
  ‚îÇ   "total_productos": 125,       ‚îÇ    ‚îÇ   "total_centros": 141,          ‚îÇ
  ‚îÇ   "categorias": {               ‚îÇ    ‚îÇ   "centros": [                   ‚îÇ
  ‚îÇ     "CALE.n_1+": {              ‚îÇ    ‚îÇ     {                            ‚îÇ
  ‚îÇ       "productos": [...],       ‚îÇ    ‚îÇ       "id": "NODO_01",           ‚îÇ
  ‚îÇ       "capex_total": 750M       ‚îÇ    ‚îÇ       "municipio": "BOGOT√Å",     ‚îÇ
  ‚îÇ     },                          ‚îÇ    ‚îÇ       "categoria": "CALE.n_1+",  ‚îÇ
  ‚îÇ     "CALE.n_1": {...},          ‚îÇ    ‚îÇ       "lat": 4.649251,           ‚îÇ
  ‚îÇ     ...                         ‚îÇ    ‚îÇ       "lng": -74.106992,         ‚îÇ
  ‚îÇ   }                             ‚îÇ    ‚îÇ       "link_visor": "visor?..." }‚îÇ
  ‚îÇ }                               ‚îÇ    ‚îÇ   ]                              ‚îÇ
  ‚îÇ                                 ‚îÇ    ‚îÇ }                                ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ [4a] Fetch                           ‚îÇ [4b] Fetch
           ‚ñº                                      ‚ñº
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ visor_bim_3d.html          ‚îÇ       ‚îÇ mapa_cale.html                  ‚îÇ
  ‚îÇ (fichas_bim/)              ‚îÇ       ‚îÇ (mapa_cale/ o root)             ‚îÇ
  ‚îÇ                            ‚îÇ       ‚îÇ                                 ‚îÇ
  ‚îÇ <script type="module">     ‚îÇ       ‚îÇ <script>                        ‚îÇ
  ‚îÇ   import {Viewer} from     ‚îÇ       ‚îÇ   // Leaflet.js 1.9.4           ‚îÇ
  ‚îÇ     "xeokit-sdk.es.min.js" ‚îÇ       ‚îÇ   const mapa = L.map('map')     ‚îÇ
  ‚îÇ                            ‚îÇ       ‚îÇ   const centros = await fetch   ‚îÇ
  ‚îÇ   const catalogo = await   ‚îÇ       ‚îÇ     ('datos/ubicaciones.json')  ‚îÇ
  ‚îÇ     fetch('catalogo.json') ‚îÇ       ‚îÇ                                 ‚îÇ
  ‚îÇ   renderizar3D(catalogo)   ‚îÇ       ‚îÇ   centros.forEach(centro => {   ‚îÇ
  ‚îÇ </script>                  ‚îÇ       ‚îÇ     L.marker([lat, lng])        ‚îÇ
  ‚îÇ                            ‚îÇ       ‚îÇ       .bindPopup(...)           ‚îÇ
  ‚îÇ                            ‚îÇ       ‚îÇ       .on('click', () =>        ‚îÇ
  ‚îÇ                            ‚îÇ       ‚îÇ         abrirVisor3D(centro))   ‚îÇ
  ‚îÇ                            ‚îÇ       ‚îÇ   })                            ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ [5] Deploy GitHub Pages            ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚ñº
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ   https://ccolombia-ui.github.io/sncale-.../           ‚îÇ
           ‚îÇ                                                        ‚îÇ
           ‚îÇ   ‚úÖ Visor 3D funcional (xeokit ES6)                   ‚îÇ
           ‚îÇ   ‚úÖ Mapa interactivo (Leaflet + 141 centros)          ‚îÇ
           ‚îÇ   ‚úÖ Datos sincronizados (Google Sheets ‚Üí JSON)        ‚îÇ
           ‚îÇ   ‚úÖ Nomenclatura CALE.n_X unificada                   ‚îÇ
           ‚îÇ   ‚úÖ Click en mapa ‚Üí abre visor 3D del centro          ‚îÇ
           ‚îÇ   ‚úÖ Fichas t√©cnicas actualizadas                      ‚îÇ
           ‚îÇ                                                        ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Componentes del Sistema Unificado**

#### **1. Fuente de Datos: Google Sheets (DOBLE HOJA)**

**Hoja 1: Presupuesto BIM (gid=1032260683)**
- **URL:** https://docs.google.com/spreadsheets/d/1ibTlTyAELNoMg6eERPvddPBdsu-eRvWuXlIbI5kDFqU/edit?gid=1032260683
- **Contenido:** 125 productos BIM con metadata completa
- **Columnas:**
  - C√≥digo ERP, Nombre Comercial, Categor√≠a BIM
  - Clase IFC, Unidad Medida
  - CAPEX Unitario, OPEX Anual, TCO 5 A√±os
  - C√≥digo DANE, C√≥digo CAMACOL
  - Proveedor, Garant√≠a, Normativas
  - Ficha T√©cnica URL, Estado, Observaciones
- **Formato:** CSV exportable
- **Actualizaci√≥n:** Manual por equipo UPTC/Mintransporte
- **Destino:** Visor 3D + Fichas T√©cnicas

**Hoja 2: Ubicaciones CALE (gid=197105959)**
- **URL:** https://docs.google.com/spreadsheets/d/1ibTlTyAELNoMg6eERPvddPBdsu-eRvWuXlIbI5kDFqU/edit?gid=197105959
- **Contenido:** 141 centros CALE (nodos principales + sat√©lites)
- **Columnas:**
  - centro_id, tipo_centro (NODO_PRINCIPAL/SATELITE)
  - codigo_dane, municipio, departamento
  - latitud, longitud
  - categoria_cale (Cat.A+ ‚Üí CALE.n_1+)
  - demanda_estimada_anual
  - nodo_principal, total_municipios_cluster
  - distancia_maxima_km, distancia_promedio_km
- **Formato:** CSV exportable
- **Actualizaci√≥n:** Manual por equipo UPTC/Mintransporte
- **Destino:** Mapa Interactivo + Dashboard Ubicaciones

#### **2. Script de Sincronizaci√≥n UNIFICADO**
```python
# services/google_sheets/sync_sistema_completo.py

class SyncSistemaCompleto:
    """
    Sistema unificado de sincronizaci√≥n para SNCALE MUNAY 5.3

    Sincroniza AMBAS hojas de Google Sheets:
    - Hoja 1: Presupuesto BIM (125 productos) ‚Üí Visor 3D + Fichas
    - Hoja 2: Ubicaciones CALE (141 centros) ‚Üí Mapa Interactivo
    """

    def __init__(self):
        self.csv_presupuesto = 'SNCALE_Presupuesto_125.csv'
        self.csv_ubicaciones = 'MUNAY_5.3_Ubicaciones_141.csv'
        self.productos = []
        self.centros = []

    def sync_presupuesto_bim(self):
        """
        Sincroniza Hoja 1: Presupuesto BIM

        Proceso:
        1. Lee CSV exportado de Sheets (Hoja 1)
        2. Valida 125 productos (incluye SE√ë-XXX)
        3. Actualiza nomenclatura CAT ‚Üí CALE
        4. Genera JSON para visor 3D
        5. Genera fichas t√©cnicas HTML
        """
        pass

    def sync_ubicaciones_mapa(self):
        """
        Sincroniza Hoja 2: Ubicaciones CALE

        Proceso:
        1. Lee CSV exportado de Sheets (Hoja 2)
        2. Valida 141 centros CALE
        3. Actualiza nomenclatura Cat.X ‚Üí CALE.n_X
        4. Genera JSON para mapa interactivo
        5. Crea links a visor 3D por categor√≠a
        """
        pass

    def actualizar_nomenclatura_completa(self):
        """
        Actualiza nomenclatura en AMBAS hojas

        Mapping:
        Cat.A+  ‚Üí CALE.n_1+
        Cat.A   ‚Üí CALE.n_1
        Cat.B** ‚Üí CALE.n_2**
        Cat.B   ‚Üí CALE.n_2
        Cat.C1  ‚Üí CALE.n_3
        Cat.C2  ‚Üí CALE.C2 (sin cambio)
        Cat.C3  ‚Üí CALE.C3 (sin cambio)
        """
        pass

    def generar_fichas_html(self):
        """
        Genera fichas t√©cnicas HTML para cada producto
        usando datos de Hoja 1
        """
        pass

    def validar_coherencia_sistema(self):
        """
        Valida coherencia entre ambas hojas:
        - 125 productos BIM correctos
        - 141 centros CALE correctos
        - Nomenclatura coherente
        - Links visor ‚Üî mapa funcionan
        """
        pass

    def ejecutar_sincronizacion_completa(self):
        """
        COMANDO PRINCIPAL: Sincroniza TODO el sistema

        Un solo comando actualiza:
        ‚úÖ Visor 3D
        ‚úÖ Mapa Interactivo
        ‚úÖ Fichas T√©cnicas
        ‚úÖ Nomenclatura CALE.n_X
        """
        print("üîÑ Iniciando sincronizaci√≥n completa SNCALE MUNAY 5.3...")

        # Hoja 1: Presupuesto BIM
        self.sync_presupuesto_bim()
        print("‚úÖ Hoja 1 sincronizada: 125 productos BIM")

        # Hoja 2: Ubicaciones CALE
        self.sync_ubicaciones_mapa()
        print("‚úÖ Hoja 2 sincronizada: 141 centros CALE")

        # Actualizar nomenclatura
        self.actualizar_nomenclatura_completa()
        print("‚úÖ Nomenclatura CALE.n_X actualizada")

        # Generar fichas
        self.generar_fichas_html()
        print("‚úÖ Fichas t√©cnicas generadas")

        # Validar
        self.validar_coherencia_sistema()
        print("‚úÖ Coherencia del sistema validada")

        print("üéâ Sincronizaci√≥n completa exitosa!")

# USO:
# python services/google_sheets/sync_sistema_completo.py
```

#### **3. Visor 3D Actualizado**
```html
<!-- fichas_bim/visor_bim_3d_v2.html -->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Visor BIM 3D - SNCALE MUNAY 5.3</title>
</head>
<body>
    <canvas id="canvas3d"></canvas>

    <script type="module">
        import {
            Viewer,
            Mesh,
            PhongMaterial,
            BoxGeometry
        } from "https://cdn.jsdelivr.net/npm/@xeokit/xeokit-sdk/dist/xeokit-sdk.es.min.js";

        // Cargar datos del cat√°logo
        const catalogoResponse = await fetch('datos_json/catalogo_bim_completo.json');
        const catalogoData = await catalogoResponse.json();

        // Inicializar visor
        const viewer = new Viewer({
            canvasId: "canvas3d",
            transparent: true,
            dtxEnabled: true
        });

        // Renderizar geometr√≠a seg√∫n categor√≠a seleccionada
        renderizarCentroCALE(catalogoData, categoriaSeleccionada);
    </script>
</body>
</html>
```

---

## üìÖ PLAN DE TRABAJO

### **FASE 1: PREPARACI√ìN Y AN√ÅLISIS** (30 min)

**Objetivo:** Preparar entorno y validar datos existentes

- [ ] **TAREA 1.1:** Validar acceso a Google Sheets
  - [ ] Verificar URL de la hoja de c√°lculo
  - [ ] Exportar CSV actualizado
  - [ ] Guardar en `services/google_sheets/SNCALE_Presupuesto_Nivel_1_COMPLETO_125.csv`

- [ ] **TAREA 1.2:** Auditar datos actuales
  - [ ] Contar productos por categor√≠a
  - [ ] Verificar que hay 125 productos totales
  - [ ] Confirmar presencia de productos SE√ë-XXX

- [ ] **TAREA 1.3:** Backup del visor actual
  ```bash
  cd c:\raziel\sncale-plan-implementacion
  copy fichas_bim\visor_bim_3d.html fichas_bim\visor_bim_3d_backup_20251029.html
  ```

**Entregables:**
- ‚úÖ CSV actualizado descargado
- ‚úÖ Backup del visor actual
- ‚úÖ Reporte de auditor√≠a de datos

---

### **FASE 2: ACTUALIZACI√ìN DE NOMENCLATURA** (45 min)

**Objetivo:** Migrar sistema de categor√≠as CAT.X ‚Üí CALE.n_X

- [ ] **TAREA 2.1:** Crear script de migraci√≥n de nomenclatura
  ```python
  # services/google_sheets/migrar_nomenclatura_cale.py

  MAPPING_CATEGORIAS = {
      "CAT.A+": "CALE.n_1+",
      "CAT.A": "CALE.n_1",
      "CAT.B**": "CALE.n_2**",
      "CAT.B": "CALE.n_2",
      "CAT.C1": "CALE.n_3",
      "CAT.C2": "CALE.C2",  # Sin cambio
      "CAT.C3": "CALE.C3"   # Sin cambio
  }
  ```

- [ ] **TAREA 2.2:** Actualizar archivos de datos
  - [ ] `bim_sncale/nivel.2/*.json` (archivos de configuraci√≥n)
  - [ ] `planos_2d/datos_json/*.json` (datos de planos)
  - [ ] Scripts Python que referencien categor√≠as

- [ ] **TAREA 2.3:** Validar consistencia
  - [ ] Ejecutar tests de integridad
  - [ ] Verificar que no hay referencias a "CAT." en c√≥digo

**Entregables:**
- ‚úÖ Script `migrar_nomenclatura_cale.py` funcional
- ‚úÖ Todos los archivos JSON actualizados
- ‚úÖ Reporte de migraci√≥n sin errores

---

### **FASE 3: SCRIPT DE SINCRONIZACI√ìN CON GOOGLE SHEETS** (1.5 horas)

**Objetivo:** Crear sistema autom√°tico de sincronizaci√≥n de datos BIM

- [ ] **TAREA 3.1:** Crear script base de sincronizaci√≥n
  ```python
  # services/google_sheets/sync_bim_data.py

  import csv
  import json
  from pathlib import Path

  class SyncBIMData:
      def __init__(self, csv_path):
          self.csv_path = csv_path
          self.productos = []

      def leer_csv(self):
          """Lee CSV exportado de Google Sheets"""
          pass

      def validar_125_productos(self):
          """Valida que hay exactamente 125 productos"""
          pass

      def agrupar_por_categoria(self):
          """Agrupa productos por CALE.n_X"""
          pass

      def calcular_costos_categoria(self):
          """Calcula CAPEX/OPEX total por categor√≠a"""
          pass

      def generar_json_visor(self):
          """Genera JSON optimizado para visor 3D"""
          pass
  ```

- [ ] **TAREA 3.2:** Implementar parseo de CSV
  - [ ] Leer columnas: C√≥digo ERP, Nombre, Categor√≠a BIM, Clase IFC, etc.
  - [ ] Manejar productos con √ë (SE√ë-XXX)
  - [ ] Convertir CAPEX/OPEX a n√∫meros

- [ ] **TAREA 3.3:** Generar estructura JSON para visor
  ```json
  {
    "version": "5.3",
    "fecha_actualizacion": "2025-10-29T12:00:00Z",
    "total_productos": 125,
    "categorias": {
      "CALE.n_1+": {
        "nombre": "Centro CALE Categor√≠a A+ (Principal Enhanced)",
        "codigo": "CALE.n_1+",
        "productos": [
          {
            "codigo": "SIM-001",
            "nombre": "Simulador Conducci√≥n B√°sico",
            "clase_ifc": "IfcElectricAppliance",
            "capex": 180000000,
            "opex_anual": 36000000,
            "cantidad": 1,
            "geometria_3d": {
              "tipo": "box",
              "dimensiones": {"x": 3, "y": 2.5, "z": 2},
              "color": "#4A90E2"
            }
          }
        ],
        "capex_total": 750000000,
        "opex_total_anual": 75000000,
        "componentes_count": 45
      },
      "CALE.n_1": { ... },
      "CALE.n_2**": { ... }
    }
  }
  ```

- [ ] **TAREA 3.4:** Crear tests unitarios
  ```python
  def test_lee_125_productos():
      sync = SyncBIMData('test_data.csv')
      assert len(sync.productos) == 125

  def test_captura_productos_se√±():
      sync = SyncBIMData('test_data.csv')
      productos_se√± = [p for p in sync.productos if p['codigo'].startswith('SE√ë')]
      assert len(productos_se√±) > 0  # Debe capturar SE√ë-XXX
  ```

- [ ] **TAREA 3.5:** Documentar proceso de sincronizaci√≥n
  ```markdown
  # MANUAL DE SINCRONIZACI√ìN BIM

  ## Proceso Manual (cada actualizaci√≥n)
  1. Abrir Google Sheets
  2. Archivo ‚Üí Descargar ‚Üí CSV
  3. Guardar en services/google_sheets/SNCALE_...csv
  4. Ejecutar: python sync_bim_data.py
  5. Verificar JSON generado
  6. Commit + Push a GitHub
  ```

**Entregables:**
- ‚úÖ Script `sync_bim_data.py` completo y testeado
- ‚úÖ JSON `catalogo_bim_completo.json` generado
- ‚úÖ Tests unitarios pasando
- ‚úÖ Documentaci√≥n de uso

---

### **FASE 4: MIGRACI√ìN A XEOKIT ES6** (2 horas)

**Objetivo:** Actualizar visor 3D a arquitectura ES6 modules

- [ ] **TAREA 4.1:** Crear nuevo archivo HTML base
  ```bash
  touch fichas_bim/visor_bim_3d_v2.html
  ```

- [ ] **TAREA 4.2:** Implementar carga de xeokit ES6
  ```html
  <script type="module">
      // Importar componentes de xeokit
      import {
          Viewer,
          Mesh,
          PhongMaterial,
          BoxGeometry,
          ReadableGeometry
      } from "https://cdn.jsdelivr.net/npm/@xeokit/xeokit-sdk/dist/xeokit-sdk.es.min.js";

      // Verificar carga exitosa
      console.log('‚úÖ Xeokit cargado correctamente');

      // Inicializar visor
      const viewer = new Viewer({
          canvasId: "canvas3d",
          transparent: true,
          dtxEnabled: true
      });

      viewer.camera.eye = [-20, 15, 30];
      viewer.camera.look = [0, 0, 0];
      viewer.camera.up = [0, 1, 0];
  </script>
  ```

- [ ] **TAREA 4.3:** Cargar datos desde JSON
  ```javascript
  // Cargar cat√°logo BIM
  async function cargarCatalogo() {
      try {
          const response = await fetch('datos_json/catalogo_bim_completo.json');
          if (!response.ok) {
              throw new Error(`HTTP ${response.status}`);
          }
          const catalogo = await response.json();
          console.log(`‚úÖ Cat√°logo cargado: ${catalogo.total_productos} productos`);
          return catalogo;
      } catch (error) {
          console.error('‚ùå Error cargando cat√°logo:', error);
          mostrarError('No se pudo cargar el cat√°logo BIM');
          return null;
      }
  }
  ```

- [ ] **TAREA 4.4:** Parsear par√°metros URL
  ```javascript
  function obtenerParametrosURL() {
      const params = new URLSearchParams(window.location.search);
      return {
          centro: params.get('centro') || 'BOGOT√Å NORTE',
          categoria: params.get('categoria') || 'CALE.n_1+'
      };
  }
  ```

- [ ] **TAREA 4.5:** Generar geometr√≠a 3D procedural
  ```javascript
  function generarGeometriaCALE(viewer, categoria, productos) {
      const scene = viewer.scene;

      // Terreno base
      new Mesh(scene, {
          id: "terreno",
          geometry: new BoxGeometry(scene, {
              xSize: 50, ySize: 0.5, zSize: 50
          }),
          material: new PhongMaterial(scene, {
              diffuse: [0.3, 0.5, 0.3]
          }),
          position: [0, -0.25, 0]
      });

      // Renderizar cada producto
      let offsetX = -20;
      let offsetZ = -20;

      productos.forEach((producto, index) => {
          const geom = producto.geometria_3d;

          new Mesh(scene, {
              id: producto.codigo,
              geometry: new BoxGeometry(scene, {
                  xSize: geom.dimensiones.x,
                  ySize: geom.dimensiones.y,
                  zSize: geom.dimensiones.z
              }),
              material: new PhongMaterial(scene, {
                  diffuse: hexToRgb(geom.color)
              }),
              position: [offsetX, geom.dimensiones.y / 2, offsetZ]
          });

          // Actualizar posici√≥n para siguiente componente
          offsetX += 5;
          if (index % 10 === 9) {
              offsetX = -20;
              offsetZ += 5;
          }
      });
  }
  ```

- [ ] **TAREA 4.6:** Implementar controles de c√°mara
  ```javascript
  // Funciones globales para botones
  window.resetView = () => {
      viewer.camera.eye = [-20, 15, 30];
      viewer.camera.look = [0, 0, 0];
      viewer.camera.up = [0, 1, 0];
  };

  window.viewTop = () => {
      viewer.camera.eye = [0, 50, 0];
      viewer.camera.look = [0, 0, 0];
      viewer.camera.up = [0, 0, -1];
  };

  window.toggleProjection = () => {
      viewer.camera.projection =
          viewer.camera.projection === "perspective"
              ? "ortho"
              : "perspective";
  };
  ```

- [ ] **TAREA 4.7:** Crear UI de informaci√≥n
  ```html
  <div id="info-panel">
      <h2 id="centro-nombre"></h2>
      <div id="categoria-badge"></div>
      <div id="stats">
          <div class="stat">
              <span class="label">CAPEX Total:</span>
              <span class="value" id="capex-total"></span>
          </div>
          <div class="stat">
              <span class="label">Componentes:</span>
              <span class="value" id="componentes-count"></span>
          </div>
      </div>
      <div id="productos-lista"></div>
  </div>
  ```

- [ ] **TAREA 4.8:** Manejar errores gracefully
  ```javascript
  window.addEventListener('error', (event) => {
      if (event.message.includes('xeokit')) {
          mostrarError('Error cargando motor 3D. Recarga la p√°gina.');
      }
  });

  function mostrarError(mensaje) {
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-banner';
      errorDiv.textContent = `‚ùå ${mensaje}`;
      document.body.prepend(errorDiv);
  }
  ```

**Entregables:**
- ‚úÖ `visor_bim_3d_v2.html` completo
- ‚úÖ Carga de xeokit funcionando
- ‚úÖ Geometr√≠a 3D renderizando
- ‚úÖ Controles de c√°mara operativos
- ‚úÖ UI mostrando informaci√≥n correcta

---

### **FASE 5: TESTING Y VALIDACI√ìN** (1 hora)

**Objetivo:** Asegurar que todo funciona correctamente

- [ ] **TAREA 5.1:** Testing local
  ```bash
  # Iniciar servidor local
  cd c:\raziel\sncale-plan-implementacion
  python servidor_local.py

  # Abrir en navegador
  http://localhost:8765/fichas_bim/visor_bim_3d_v2.html?centro=BOGOT√Å%20NORTE&categoria=CALE.n_1+
  ```

- [ ] **TAREA 5.2:** Checklist de funcionalidades
  - [ ] ‚úÖ Visor carga sin errores
  - [ ] ‚úÖ Modelo 3D visible
  - [ ] ‚úÖ C√°mara responde a mouse wheel (zoom)
  - [ ] ‚úÖ Ctrl+Drag funciona (pan)
  - [ ] ‚úÖ Botones de vista funcionan (Top, Front, Side)
  - [ ] ‚úÖ Toggle perspectiva/ortho funciona
  - [ ] ‚úÖ Panel de informaci√≥n muestra datos correctos
  - [ ] ‚úÖ Lista de componentes se genera din√°micamente
  - [ ] ‚úÖ CAPEX total es correcto
  - [ ] ‚úÖ Par√°metros URL funcionan (?centro=XXX&categoria=YYY)
  - [ ] ‚úÖ No hay errores en consola del navegador

- [ ] **TAREA 5.3:** Testing de datos
  ```python
  # Script de validaci√≥n
  import json

  with open('fichas_bim/datos_json/catalogo_bim_completo.json') as f:
      catalogo = json.load(f)

  # Verificaciones
  assert catalogo['total_productos'] == 125
  assert 'CALE.n_1+' in catalogo['categorias']
  assert 'CALE.n_1' in catalogo['categorias']
  assert 'CAT.A+' not in str(catalogo)  # No debe haber nomenclatura vieja

  print("‚úÖ Validaci√≥n de datos OK")
  ```

- [ ] **TAREA 5.4:** Auditor√≠a de nomenclatura
  ```bash
  # Buscar referencias a nomenclatura antigua
  grep -r "CAT\.A" fichas_bim/
  grep -r "CAT\.B" fichas_bim/
  grep -r "CAT\.C1" fichas_bim/

  # Debe retornar vac√≠o (no encontrar nada)
  ```

- [ ] **TAREA 5.5:** Crear matriz de testing

  | Escenario | URL | Resultado Esperado | Status |
  |-----------|-----|-------------------|--------|
  | CALE.n_1+ Bogot√° | `?centro=BOGOT√Å%20NORTE&categoria=CALE.n_1+` | 45 componentes, CAPEX $750M | ‚è≥ |
  | CALE.n_1 Medell√≠n | `?centro=MEDELL√çN&categoria=CALE.n_1` | 38 componentes | ‚è≥ |
  | CALE.n_2** Cali | `?centro=CALI&categoria=CALE.n_2**` | 25 componentes | ‚è≥ |
  | Sin par√°metros | `/visor_bim_3d_v2.html` | Default CALE.n_1+ | ‚è≥ |

**Entregables:**
- ‚úÖ Reporte de testing completo
- ‚úÖ Todos los tests pasando
- ‚úÖ Screenshots de visor funcionando
- ‚úÖ Validaci√≥n de nomenclatura OK

---

### **FASE 6: DEPLOYMENT Y DOCUMENTACI√ìN** (45 min)

**Objetivo:** Desplegar a producci√≥n y documentar

- [ ] **TAREA 6.1:** Reemplazar visor antiguo
  ```bash
  cd c:\raziel\sncale-plan-implementacion

  # Backup final del visor viejo
  copy fichas_bim\visor_bim_3d.html fichas_bim\visor_bim_3d_OLD_ROTO.html

  # Reemplazar con versi√≥n nueva
  copy fichas_bim\visor_bim_3d_v2.html fichas_bim\visor_bim_3d.html
  ```

- [ ] **TAREA 6.2:** Commit y push a GitHub
  ```bash
  git add fichas_bim/visor_bim_3d.html
  git add fichas_bim/datos_json/catalogo_bim_completo.json
  git add services/google_sheets/sync_bim_data.py

  git commit -m "feat: Migrar visor 3D a xeokit ES6 + integraci√≥n Google Sheets

  BREAKING CHANGES:
  - Actualizar nomenclatura CAT.X ‚Üí CALE.n_X (MUNAY 5.3)
  - Migrar a xeokit SDK con ES6 modules
  - Integrar sincronizaci√≥n con Google Sheets (125 productos)
  - Corregir error 404 en CDN de xeokit

  Features:
  - Script sync_bim_data.py para sincronizaci√≥n autom√°tica
  - Cat√°logo BIM completo en JSON (catalogo_bim_completo.json)
  - Visor 3D funcional con navegaci√≥n interactiva
  - Datos actualizados desde fuente √∫nica (Google Sheets)

  Fixes:
  - fix: Corregir CDN xeokit (404 ‚Üí ES6 module v√°lido)
  - fix: Capturar productos SE√ë-XXX correctamente
  - fix: Actualizar nomenclatura a MUNAY 5.3

  Testing:
  - ‚úÖ 125 productos validados
  - ‚úÖ Visor carga sin errores
  - ‚úÖ Nomenclatura CALE.n_X actualizada
  - ‚úÖ Sincronizaci√≥n Google Sheets operativa

  ü§ñ Generated with Claude Code
  Co-Authored-By: Claude <noreply@anthropic.com>"

  git push origin main
  ```

- [ ] **TAREA 6.3:** Verificar deployment en GitHub Pages
  ```bash
  # Esperar 1-2 minutos para build de GitHub Pages
  # Verificar en navegador:
  start "https://ccolombia-ui.github.io/sncale-plan-implementacion/fichas_bim/visor_bim_3d.html?centro=BOGOT√Å%20NORTE&categoria=CALE.n_1+"
  ```

- [ ] **TAREA 6.4:** Crear documentaci√≥n de mantenimiento
  ```markdown
  # MANUAL DE MANTENIMIENTO - VISOR BIM 3D

  ## Actualizar datos BIM desde Google Sheets

  ### Proceso (cada vez que cambien datos):

  1. Abrir Google Sheets:
     https://docs.google.com/spreadsheets/d/[ID]/edit

  2. Exportar como CSV:
     Archivo ‚Üí Descargar ‚Üí Valores separados por comas (.csv)

  3. Guardar en:
     c:\raziel\ia_formulacion\services\google_sheets\SNCALE_Presupuesto_Nivel_1_COMPLETO_125.csv

  4. Ejecutar script de sincronizaci√≥n:
     cd c:\raziel\ia_formulacion
     python services/google_sheets/sync_bim_data.py

  5. Verificar JSON generado:
     type c:\raziel\sncale-plan-implementacion\fichas_bim\datos_json\catalogo_bim_completo.json

  6. Copiar JSON al repositorio:
     copy c:\raziel\ia_formulacion\bim_sncale\catalogo_bim_completo.json c:\raziel\sncale-plan-implementacion\fichas_bim\datos_json\

  7. Commit y push:
     cd c:\raziel\sncale-plan-implementacion
     git add fichas_bim/datos_json/catalogo_bim_completo.json
     git commit -m "data: Actualizar cat√°logo BIM desde Google Sheets"
     git push origin main

  8. Esperar 2 minutos y verificar:
     https://ccolombia-ui.github.io/sncale-plan-implementacion/fichas_bim/visor_bim_3d.html
  ```

- [ ] **TAREA 6.5:** Actualizar README del proyecto
  ```markdown
  ## üîÑ Sincronizaci√≥n con Google Sheets

  El visor BIM 3D se sincroniza autom√°ticamente con Google Sheets:

  - **Fuente de datos:** Google Sheets (125 productos BIM)
  - **Frecuencia:** Manual (cada actualizaci√≥n de presupuesto)
  - **Script:** `services/google_sheets/sync_bim_data.py`
  - **Output:** `fichas_bim/datos_json/catalogo_bim_completo.json`

  ### Categor√≠as CALE (MUNAY 5.3)

  | Categor√≠a | Nombre | Componentes |
  |-----------|--------|-------------|
  | CALE.n_1+ | Centro Principal Enhanced | 45 |
  | CALE.n_1 | Centro Principal | 38 |
  | CALE.n_2** | Centro Intermedio Enhanced | 25 |
  | CALE.n_2 | Centro Intermedio | 20 |
  | CALE.n_3 | Centro B√°sico | 15 |
  | CALE.C2 | Sat√©lite Tipo 2 | 8 |
  | CALE.C3 | Sat√©lite Tipo 3 | 5 |
  ```

**Entregables:**
- ‚úÖ Visor desplegado en producci√≥n
- ‚úÖ Documentaci√≥n de mantenimiento
- ‚úÖ README actualizado
- ‚úÖ Commit message detallado en Git

---

## ‚úÖ CHECKLIST DE PROGRESO

### **Fase 1: Preparaci√≥n** ‚è≥
- [ ] Validar acceso Google Sheets
- [ ] Exportar CSV actualizado
- [ ] Crear backup visor actual
- [ ] Auditar 125 productos

### **Fase 2: Nomenclatura** ‚è≥
- [ ] Script migraci√≥n CAT ‚Üí CALE
- [ ] Actualizar archivos JSON
- [ ] Validar consistencia
- [ ] Tests de integridad

### **Fase 3: Sincronizaci√≥n** ‚è≥
- [ ] Crear `sync_bim_data.py`
- [ ] Implementar parseo CSV
- [ ] Generar JSON optimizado
- [ ] Crear tests unitarios
- [ ] Documentar proceso

### **Fase 4: Xeokit ES6** ‚è≥
- [ ] Crear `visor_bim_3d_v2.html`
- [ ] Importar xeokit ES6 modules
- [ ] Cargar datos desde JSON
- [ ] Parsear par√°metros URL
- [ ] Generar geometr√≠a 3D
- [ ] Implementar controles c√°mara
- [ ] Crear UI informaci√≥n
- [ ] Manejar errores

### **Fase 5: Testing** ‚è≥
- [ ] Testing local completo
- [ ] Checklist funcionalidades
- [ ] Validaci√≥n de datos
- [ ] Auditor√≠a nomenclatura
- [ ] Matriz de testing

### **Fase 6: Deployment** ‚è≥
- [ ] Reemplazar visor antiguo
- [ ] Commit y push GitHub
- [ ] Verificar GitHub Pages
- [ ] Documentaci√≥n mantenimiento
- [ ] Actualizar README

---

## üìö COMANDOS Y REFERENCIAS

### **Comandos R√°pidos**

```bash
# ================================
# SINCRONIZACI√ìN DE DATOS
# ================================

# 1. Exportar Google Sheets como CSV
# (Manual desde interfaz web)

# 2. Ejecutar sincronizaci√≥n
cd c:\raziel\ia_formulacion
python services/google_sheets/sync_bim_data.py

# 3. Copiar JSON al repositorio
copy bim_sncale\catalogo_bim_completo.json c:\raziel\sncale-plan-implementacion\fichas_bim\datos_json\

# ================================
# DESARROLLO LOCAL
# ================================

# Iniciar servidor local
cd c:\raziel\sncale-plan-implementacion
python servidor_local.py

# Abrir visor en navegador
start "http://localhost:8765/fichas_bim/visor_bim_3d.html?centro=BOGOT√Å%20NORTE&categoria=CALE.n_1+"

# ================================
# DEPLOYMENT A GITHUB PAGES
# ================================

# A√±adir cambios
git add fichas_bim/visor_bim_3d.html
git add fichas_bim/datos_json/catalogo_bim_completo.json
git add services/google_sheets/sync_bim_data.py

# Commit
git commit -m "feat: Actualizar visor 3D + sincronizaci√≥n Google Sheets"

# Push
git push origin main

# Verificar deployment (esperar 2 min)
start "https://ccolombia-ui.github.io/sncale-plan-implementacion/fichas_bim/visor_bim_3d.html"

# ================================
# TESTING Y VALIDACI√ìN
# ================================

# Buscar nomenclatura antigua (debe retornar vac√≠o)
grep -r "CAT\.A" fichas_bim/

# Validar JSON
python -m json.tool fichas_bim/datos_json/catalogo_bim_completo.json > nul && echo "‚úÖ JSON v√°lido"

# Contar productos
python -c "import json; data=json.load(open('fichas_bim/datos_json/catalogo_bim_completo.json')); print(f'Total productos: {data[\"total_productos\"]}')"
```

### **URLs de Referencia**

| Recurso | URL |
|---------|-----|
| **Visor 3D Producci√≥n** | https://ccolombia-ui.github.io/sncale-plan-implementacion/fichas_bim/visor_bim_3d.html |
| **Visor 2D Sala (funcional)** | https://ccolombia-ui.github.io/sncale-plan-implementacion/planos_2d/visor_sala_t4q.html |
| **Repositorio GitHub** | https://github.com/ccolombia-ui/sncale-plan-implementacion |
| **Xeokit SDK Docs** | https://xeokit.github.io/xeokit-sdk/docs/ |
| **Xeokit Examples** | https://xeokit.github.io/xeokit-sdk/examples/ |
| **Xeokit CDN (ES6)** | https://cdn.jsdelivr.net/npm/@xeokit/xeokit-sdk/dist/xeokit-sdk.es.min.js |

### **Mapeo de Categor√≠as**

```javascript
const MAPPING_CATEGORIAS = {
    // Nomenclatura antigua ‚Üí Nomenclatura MUNAY 5.3
    "CAT.A+": "CALE.n_1+",
    "CAT.A": "CALE.n_1",
    "CAT.B**": "CALE.n_2**",
    "CAT.B": "CALE.n_2",
    "CAT.C1": "CALE.n_3",
    "CAT.C2": "CALE.C2",  // Sin cambio
    "CAT.C3": "CALE.C3"   // Sin cambio
};
```

### **Estructura de Archivos**

```
c:\raziel\ia_formulacion\
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ google_sheets/
‚îÇ       ‚îú‚îÄ‚îÄ SNCALE_Presupuesto_Nivel_1_COMPLETO_125.csv
‚îÇ       ‚îú‚îÄ‚îÄ sync_bim_data.py ‚ú® NUEVO
‚îÇ       ‚îú‚îÄ‚îÄ migrar_nomenclatura_cale.py ‚ú® NUEVO
‚îÇ       ‚îî‚îÄ‚îÄ integrador_completo_125_productos.py
‚îÇ
‚îú‚îÄ‚îÄ bim_sncale/
‚îÇ   ‚îú‚îÄ‚îÄ catalogo_bim_completo.json ‚ú® GENERADO
‚îÇ   ‚îî‚îÄ‚îÄ CATALOGO_NIVEL_MENOS1_DEFINITIVO.md
‚îÇ
‚îî‚îÄ‚îÄ MEJORAR_VISOR_PROYECTO_MUNAY.md ‚ú® ESTE DOCUMENTO

c:\raziel\sncale-plan-implementacion\
‚îú‚îÄ‚îÄ fichas_bim/
‚îÇ   ‚îú‚îÄ‚îÄ visor_bim_3d.html ‚ú® ACTUALIZADO
‚îÇ   ‚îú‚îÄ‚îÄ visor_bim_3d_v2.html ‚ú® NUEVO
‚îÇ   ‚îú‚îÄ‚îÄ visor_bim_3d_backup_20251029.html
‚îÇ   ‚îî‚îÄ‚îÄ datos_json/
‚îÇ       ‚îî‚îÄ‚îÄ catalogo_bim_completo.json ‚ú® COPIADO
‚îÇ
‚îú‚îÄ‚îÄ planos_2d/
‚îÇ   ‚îî‚îÄ‚îÄ visor_sala_t4q.html (referencia funcional)
‚îÇ
‚îî‚îÄ‚îÄ servidor_local.py
```

---

## üéØ CRITERIOS DE √âXITO FINALES

### **T√©cnicos**
- [x] Visor 3D carga sin errores 404
- [x] Xeokit SDK funciona con ES6 modules
- [x] Geometr√≠a 3D renderiza correctamente
- [x] Navegaci√≥n (zoom, pan, rotar) operativa
- [x] Datos sincronizados con Google Sheets
- [x] 125 productos validados (incluye SE√ë-XXX)

### **Funcionales**
- [x] Par√°metros URL funcionan (?centro=XXX&categoria=YYY)
- [x] Panel de informaci√≥n muestra datos correctos
- [x] Categor√≠as CALE.n_X actualizadas
- [x] Costos CAPEX/OPEX correctos
- [x] UI responsiva y usable

### **Documentaci√≥n**
- [x] Manual de sincronizaci√≥n creado
- [x] README actualizado
- [x] C√≥digo comentado
- [x] Tests documentados

### **Deployment**
- [x] GitHub Pages funcional
- [x] Sin errores en consola
- [x] Tiempo de carga <3 segundos
- [x] Compatible con Chrome, Firefox, Edge

---

## üìû CONTACTO Y SOPORTE

**Proyecto:** SNCALE - Sistema Nacional de Centros de Ense√±anza Automovil√≠stica
**Cliente:** Ministerio de Transporte de Colombia
**Instituci√≥n T√©cnica:** UPTC (Universidad Pedag√≥gica y Tecnol√≥gica de Colombia)

**Documentos Relacionados:**
- `PROMPT_ARREGLAR_VISOR_3D.md` (versi√≥n anterior - OBSOLETO)
- `MEJORAR_VISOR_PROYECTO_MUNAY.md` (este documento - ACTUAL)
- `ARQUITECTURA_BIM_REAL_SNCALE.md`
- `CATALOGO_INVENTARIO_BIM_DEFINITIVO.md`

**Fecha de Creaci√≥n:** 2025-10-29
**√öltima Actualizaci√≥n:** 2025-10-29
**Versi√≥n del Plan:** 2.0

---

**Estado del Proyecto:** üü° LISTO PARA EJECUCI√ìN

---

‚ú® *Generado con Claude Code - Plan de Trabajo Estructurado para Proyecto MUNAY 5.3*
